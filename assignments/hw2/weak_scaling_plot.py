import matplotlib.pyplot as plt
import numpy as np



execution_data = [
    {'Impl reduce': [3.231e-06, 1.3277e-05, 3.7867e-05, 7.2818e-05, 4.6681e-05, 6.5299e-05, 0.000123218, 7.726e-05, 0.000186432, 0.000140301, 0.00793854], 'Std reduce': [1.8834e-05, 0.000328372, 0.000429582, 0.000330042, 0.000307235, 0.000102835, 0.000290683, 0.000508877, 0.000209056, 0.000408424, 0.000443465]},
    {'Impl gather': [3.7477e-05, 2.7682e-05, 6.0519e-05, 0.000115719, 9.7221e-05, 0.000107479, 0.00013721, 0.000158176, 0.000402566, 0.00263906, 0.0081327], 'Std gather': [2.0997e-05, 0.000332051, 0.000694978, 0.000185665, 0.000275173, 0.000312014, 0.000359376, 0.000167207, 0.000382049, 0.000737637, 0.000280065]},
    {'Impl broadcast O(P)': [2.35e-06, 0.000333432, 0.000377197, 3.284e-05, 2.4831e-05, 0.000110628, 4.6802e-05, 0.000103082, 4.5425e-05, 4.4034e-05, 0.00686677], 'Std broadcast': [9.551e-06, 4.2278e-05, 3.5472e-05, 7.1749e-05, 0.000100063, 6.7934e-05, 8.9881e-05, 0.000146451, 0.000106159, 6.6776e-05, 0.000142939], 'Impl broadcast O(log(P))': [2.492e-06, 4.3024e-05, 5.9109e-05, 3.2875e-05, 8.7528e-05, 0.00013843, 4.8647e-05, 0.000183628, 4.6855e-05, 0.00160361, 0.000183257]},
    {'Impl all gather': [1.0759e-05, 2.4905e-05, 0.000148073, 7.389e-05, 8.3818e-05, 0.000195141, 0.000154506, 0.000194263, 0.00136813, 0.000253468, 0.000331752], 'Std all gather': [1.619e-05, 5.6265e-05, 5.998e-05, 0.0001937, 0.000346782, 0.00025216, 0.000404555, 0.000469232, 0.000558628, 0.000178568, 0.00570803]}
    
    # {'Impl reduce': [2.745e-06, 5.3614e-05, 5.2035e-05, 5.6896e-05, 4.4773e-05, 0.000190706, 0.00365761], 'Std reduce': [0.0205357, 4.484e-05, 0.000172557, 0.000117468, 0.000268908, 0.000166343, 0.000856351]},
    # {'Impl gather': [3.994e-05, 7.6349e-05, 6.7492e-05, 9.5209e-05, 0.000168208, 0.000339724, 0.000253207], 'Std gather': [1.9524e-05, 8.186e-05, 6.2898e-05, 7.343e-05, 0.000229105, 0.000334434, 0.00041888]},
    # {'Impl broadcast O(P)': [2.409e-06, 0.000103901, 4.6737e-05, 7.9954e-05, 9.8613e-05, 9.0404e-05, 0.00996593], 'Std broadcast': [1.0368e-05, 4.8336e-05, 4.5336e-05, 6.1539e-05, 0.000112687, 8.4304e-05, 0.000146768], 'Impl broadcast O(log(P))': [2.449e-06, 1.0352e-05, 0.000187144, 4.701e-05, 4.8384e-05, 6.3587e-05, 0.000113492]},
    # {'Impl all gather': [8.091e-06, 2.422e-05, 0.000111126, 9.0004e-05, 0.000135811, 0.000439844, 0.000210046], 'Std all gather': [1.7764e-05, 0.000328398, 5.5732e-05, 0.000280418, 0.000231959, 0.000259594, 0.00595604]}

    # {'Impl reduce': [2.548e-06, 0.000567919, 0.000273058, 0.00010007, 0.000151693, 4.1479e-05, 0.00017329, 0.000219935], 
    #  'Std reduce': [1.6158e-05, 4.4912e-05, 9.5503e-05, 0.00056587, 9.6469e-05, 0.000126214, 0.000109791, 0.000403203]},
    
    # {'Impl gather': [1.8565e-05, 4.6181e-05, 0.000119566, 0.000166296, 0.000182917, 0.000237041, 0.000227277, 0.000297873], 
    #  'Std gather': [1.7953e-05, 4.3919e-05, 0.000580413, 0.000657649, 0.00011679, 0.000147994, 0.00011808, 0.000246649]},
    
    # {'Impl broadcast O(P)': [2.551e-06, 2.8324e-05, 3.2668e-05, 1.6498e-05, 4.4546e-05, 7.5091e-05, 0.000105415, 0.000104787], 
    #  'Std broadcast': [6.648e-06, 4.2083e-05, 4.5131e-05, 5.0432e-05, 4.7057e-05, 5.97e-05, 7.5071e-05, 7.6802e-05], 
    #  'Impl broadcast O(log(P))': [2.484e-06, 2.4067e-05, 3.5411e-05, 2.3093e-05, 5.0612e-05, 2.9505e-05, 7.1818e-05, 0.000105624]},
    
    # {'Impl all gather': [8.302e-06, 4.8935e-05, 0.00034124, 0.000200905, 0.000190441, 0.000117668, 0.000219614, 0.000384394], 
    #  'Std all gather': [1.4693e-05, 0.00812732, 0.000431983, 0.00026979, 0.000310872, 0.00020278, 0.000282859, 0.000272685]}
]

thread_counts = [1, 2, 4, 8, 12, 16, 20, 26, 32, 40, 48]
log_thread_counts = np.log2(thread_counts) 

for i, execution_times in enumerate(execution_data, start=1):
    plt.figure(figsize=(12, 6))
    
    for label, times in execution_times.items():
        plt.plot(log_thread_counts, times, marker='o', linestyle='-', markersize=8, label=label)

    plt.title("Elapsed Time vs. log(Number of Threads) and Element count", fontsize=16)
    plt.xlabel("log(Number of Threads, P)", fontsize=14)
    plt.ylabel("Elapsed Time, t", fontsize=14)
    plt.grid(True)
    plt.legend()

    filename = f"execution_plot_{i}.png"
    plt.savefig(filename)
    plt.close()

    print(f"Plot saved as {filename}")
